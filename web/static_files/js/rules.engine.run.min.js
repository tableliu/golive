$(document).ready(function(){String.prototype.format||(String.prototype.format=function(){"use strict";var t=this.toString();if(arguments.length){var e,i=typeof arguments[0],n="string"===i||"number"===i?Array.prototype.slice.call(arguments):arguments[0];for(e in n)t=t.replace(new RegExp("\\{"+e+"\\}","gi"),n[e])}return t});var t=function(t){return $(t)},e=function(t){var e=t.split("_",1);return"checkbox"==e?$("input[name*='"+t+"[]']"):"radio"==e?$("input[name*='"+t+"']"):$("#"+t)},i=function(t){var e;if(t instanceof Array){var i,n=[];for(i=0;i<t.length;i++){var a;a="radio"==(r=t[i].split("_",1))?"input[name='"+t[i]+"']:checked":"checkbox"==r?"input[name*='"+t[i]+"[]']:checked":"#"+t[i],n.push(a)}e=$(n.join(", "))}else{var r;e="radio"==(r=t.split("_",1))?$("input[name='"+t+"']:checked"):"checkbox"==r?$("input[name*='"+t+"[]']:checked"):$("#"+t)}return e},n=function(e){return"field"==e.find("original")?i(e.find("original","originalField")):t(e.find("original","originalElement"))},a=function(i,n){if("field"==i.find("target"))e(i.find("target","targetField")).val(n);else if("element"==i.find("target")){var a=t(i.find("target","targetElement"));a.size()>1?$.each(a,function(){$(this).is(":input")?$(this).val(n):$(this).text(n)}):a.is(":input")?a.val(n):a.text(n)}},r=function(){var r={},o=$("body"),s=o.outerHeight(!0);$.each(options.fieldIds,function(t,e){var i=e.split("_",1);if("checkbox"==i)r[e]=$("#"+e).is(":checked");else if("radio"==i){var n=e.split("_",2)[0]+"_"+e.split("_",2)[1];r[n]=$("input[name='"+n+"']:checked").val()}else r[e]="button"==i?$("#"+e).data("clicked"):$("#"+e).val()});var c={toShow:function(i){if("field"==i.find("target")){var n=e(i.find("target","targetField")).show();n.is(":radio, :checkbox")?n.css("display","inline-block"):n.show(),n.parent().closest("div.form-group").show()}else"element"==i.find("target")&&t(i.find("target","targetElement")).show()},toHide:function(i){"field"==i.find("target")?e(i.find("target","targetField")).hide().parent().closest("div.form-group").hide():"element"==i.find("target")&&t(i.find("target","targetElement")).hide()},toEnable:function(i){if("field"==i.find("target"))e(i.find("target","targetField")).prop("disabled",!1);else"element"==i.find("target")&&t(i.find("target","targetElement")).prop("disabled",!1)},toDisable:function(i){if("field"==i.find("target"))e(i.find("target","targetField")).prop("disabled",!0);else"element"==i.find("target")&&t(i.find("target","targetElement")).prop("disabled",!0)},performArithmeticOperations:function(t){!function(t){var e=t.find("operator"),n=t.find("operands"),r=NaN;e&&($.isArray(n)&&$.each(n,function(t,n){var a=i(n);if(a.size()>1)$.each(a,function(t,i){var n=parseFloat($(i).val());if(!isNaN(n))if(isNaN(r))r=n;else switch(e){case"+":r+=n;break;case"-":r-=n;break;case"*":r*=n;break;case"/":r/=n;break;case"%":r%=n}});else if(1==a.size()){var o=parseFloat(a.val());if(!isNaN(o))if(isNaN(r))r=o;else switch(e){case"+":r+=o;break;case"-":r-=o;break;case"*":r*=o;break;case"/":r/=o;break;case"%":r%=o}}}),isNaN(r)&&(r=0),a(t,r))}(t)},resetResult:function(t){if(options.submitted)return!1;a(t,0)},copy:function(i){!function(i,n){var a="field"==i.find("target")?e(i.find("target","targetField")):t(i.find("target","targetElement")),r=n.is(":input")?n.val():n.html();n.size()>1&&(r=n.map(function(){return $(this).is(":input")?$(this).val():$(this).text()}).get().filter(Boolean).join(", ")),a.size()>1?a.is(":radio, :checkbox")?n.size()>1?($(":checkbox[name*='"+a.attr("name")+"']").prop("checked",!1),$.each(n,function(){$(this).is(":checkbox")&&(r=$(this).val(),$(":checkbox[name*='"+a.attr("name")+"'][value*='"+r+"']").prop("checked",!0))})):($(":input[name*='"+a.attr("name")+"']").prop("checked",!1),$(":input[name*='"+a.attr("name")+"'][value*='"+r+"']").prop("checked",!0)):a.is(":input")?a.val(r):a.text(r):a.is(":radio, :checkbox")?($(":input[name*='"+a.attr("name")+"']").prop("checked",!1),$(":input[name*='"+a.attr("name")+"'][value*='"+r+"']").prop("checked",!0)):a.is(":input")?a.val(r):a.html(r)}(i,n(i))},skip:function(t,e){0==$.grep(options.skips,function(t){return t.id==e}).length&&options.skips.push({id:e,from:null,to:parseInt(t.find("step"))})},resetSkip:function(t,e){options.skips=$.grep(options.skips,function(t){return t.id!=e})},formatNumber:function(i){if("field"==i.find("target")){var n=e(i.find("target","targetField")),a=numeral(n.val()).format(i.find("format"));n.val(a)}else if("element"==i.find("target")){var r=t(i.find("target","targetElement")),o=numeral(r.text()).format(i.find("format"));r.text(o)}},formatText:function(i){!function(i,n){var a="field"===i.find("target")?e(i.find("target","targetField")):t(i.find("target","targetElement")),r={};n.map(function(t){r[t]=$(this).is(":input")?$(this).val():$(this).text();var e=$(this).attr("id");e.length>1&&(r[e]=$(this).is(":input")?$(this).val():$(this).text());var i=$(this).data("alias");i.length>1&&(r[i]=$(this).is(":input")?$(this).val():$(this).text())});var o=i.find("format").format(r);a.is(":radio, :checkbox")||(a.is(":input")?a.val(o):a.html(o))}(i,n(i))}};$.each(options.rules,function(t,e){var i=new RuleEngine({conditions:JSON.parse(e.conditions),actions:JSON.parse(e.actions)}),n=e.opposite?{toShow:"toHide",toHide:"toShow",toEnable:"toDisable",toDisable:"toEnable",performArithmeticOperations:"resetResult",skip:"resetSkip"}:{};i.run(r,c,n)});var f=o.outerHeight(!0);s!=f&&Utils.postMessage({height:f})};$(window).load(function(){r()});var o=$("form");o.find(":input").on("keyup change click input",function(){r()}),o.on("success",function(){r()}),o.find(":button").mousedown(function(){$(this).data("clicked",!0)})});